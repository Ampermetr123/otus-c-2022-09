#include <stdint.h>
#include <stdlib.h>


// Перемешанные значения 0 - 255
/* Такой массив может быть сгенерирован на python: 
    from random import shuffle
    table = list(range(0, 256))
    shuffle(table)
    print(table)
*/
static const uint8_t pearson_table[] = {
  146, 203, 39,  190, 156, 166, 197, 159, 92,  249, 13,  94,  244, 250, 254, 133, 107, 0,   79,
  46,  31,  91,  193, 43,  57,  113, 12,  95,  235, 164, 206, 128, 47,  224, 53,  226, 52,  155,
  112, 161, 246, 44,  218, 149, 138, 61,  100, 4,   151, 82,  62,  40,  8,   129, 142, 174, 66,
  19,  56,  123, 87,  106, 219, 195, 241, 1,   238, 10,  242, 210, 163, 213, 240, 189, 27,  20,
  83,  237, 239, 144, 78,  110, 5,   23,  37,  90,  165, 211, 154, 108, 188, 118, 36,  221, 248,
  185, 75,  150, 33,  58,  14,  18,  26,  76,  84,  63,  186, 117, 145, 126, 73,  170, 42,  134,
  54,  21,  125, 11,  65,  187, 216, 34,  6,   38,  69,  88,  67,  9,   121, 204, 215, 198, 124,
  72,  55,  60,  143, 70,  200, 45,  234, 202, 255, 77,  184, 29,  222, 229, 168, 132, 252, 137,
  7,   157, 225, 22,  209, 127, 176, 167, 160, 162, 223, 158, 231, 179, 32,  109, 153, 192, 212,
  102, 64,  120, 148, 233, 28,  152, 35,  114, 80,  85,  98,  147, 16,  181, 59,  131, 111, 89,
  207, 169, 51,  41,  183, 140, 220, 68,  30,  101, 2,   15,  208, 227, 115, 104, 214, 182, 201,
  71,  97,  230, 217, 136, 247, 191, 243, 177, 17,  105, 141, 172, 48,  96,  25,  196, 130, 93,
  175, 24,  178, 253, 194, 86,  50,  205, 3,   135, 171, 251, 116, 139, 236, 103, 119, 49,  232,
  74,  122, 245, 180, 199, 228, 99,  173, 81
};



uint32_t pearson_hash32(const char* str){
  union {
    uint32_t data;
    uint8_t ar[8];
  } hv;
  for (size_t i = 0; i<8; i++){
    uint8_t h = pearson_table[(*str + i) % 256];
    const char* s = str;
    while (*s != '\0'){
      h = pearson_table[h ^ *s];
      s++;
    }
    hv.ar[i]=h;
  }
  return hv.data;
}
